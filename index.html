<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>faceRoster</title>
    <script src="js/face-api.js"></script>
</head>

<body>
    <label>Upload Image:</label> <input id="queryImgUploadInput" type="file" onchange="uploadQueryImage(event)" accept=".jpg, .jpeg, .png">
    <div id="imagediv">
        <img id="myImg" src="bbt1.jpg" alt="">
    </div>
    <script>
    const tiny = false;
    console.time();

    function drawFaceRecognitionResults(results) {
        let paras = document.getElementsByClassName('faceNames');
        while (paras[0]) {
            paras[0].parentNode.removeChild(paras[0]);
        }
        results.forEach(function(detection) {
            let btn = document.createElement("button");
            btn.innerText = detection.classScore.toFixed(2);
            btn.style = 'position:absolute; top:' + detection.box.top + 'px;left:' + detection.box.left + 'px; zindex:2';
            btn.className = 'faceNames';
            document.getElementById("imagediv").appendChild(btn);
        })
    }

    async function loadModels() {
        if (tiny) {
            await faceapi.nets.tinyFaceDetector.load("weights");
        } else {
            await faceapi.nets.ssdMobilenetv1.load("weights");
        }
        console.timeLog();
    }

    async function updateResults() {
        if (tiny) {
            results = await faceapi.detectAllFaces(document.getElementById("myImg"), new faceapi.TinyFaceDetectorOptions());
        } else {
            results = await faceapi.detectAllFaces(document.getElementById("myImg"));
        }

        drawFaceRecognitionResults(results);

        console.timeEnd();
    }

    async function uploadQueryImage(e) {
    	console.time();
        const imgFile = e.target.files[0]
        const img = await faceapi.bufferToImage(imgFile)
        document.getElementById("myImg").src = img.src
        updateResults()
    }

    loadModels().then(updateResults)
    </script>
</body>

</html>